@model Tuple<IEnumerable<OrderDetails>, int>
@{
	ViewData["title"] = "Order Details";
	var userName = "";
	decimal toTal = 0;
	decimal subtoTal = 0;
	var stt = 1;

	Paginate pager = new Paginate();
	int pageNo = 0;
	if (ViewBag.Pager != null)
	{
		pager = ViewBag.Pager;
		pageNo = pager.CurrentPage;
	}
}
<h3>List View Order (<span style="color: orangered"> @Model.Item2 </span>)</h3>
<div class="col-md-12">
	@foreach (var item in Model.Item1)
	{
		<div style="font-size: 16px; font-weight:bold">
			Đơn hàng của tài khoản: <span style="color: chocolate">@item.UserName</span>
			<br />
			Order Code: <span style="color: chocolate">@item.OrderCode</span>
		</div>
		break;
	}
	<table class="table">
		<thead>
			<tr>
				<th scope="col">No</th>
				@* <th scope="col" width="20%">Order Code</th>
				<th scope="col">UserName</th> *@
				<th scope="col">Id</th>
				<th scope="col">Product Name</th>
				<th scope="col">Product Image</th>
				<th scope="col">Product Price</th>
				<th scope="col">Quantity</th>
				<th scope="col">SubTotal</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var item in Model.Item1)
			{
				subtoTal = item.Quantity * item.Price; // Số lượng n* đơn giá
				toTal += subtoTal;
				<tr>
					<input type="hidden" asp-for="@item.OrderCode" class="getId" />
					<th>@stt</th>
					@* <th scope="row">@item.OrderCode</th>
				<td>@item.UserName</td> *@
					<td>@item.Id</td>
					<td>@item.Product.Name</td>
					<td><img src="~/media/products/@item.Product.Image" width="70px" height="100%" /></td>
					<td>@String.Format("{0:N2}", item.Price.ToString("C"))</td>
					<td>@String.Format("{0:N2}", item.Quantity)</td>

					<td>@subtoTal.ToString("C")</td>
					@* <td> @String.Format("{0:N2}", item.Quantity * item.Price)</td> *@


					@* <td>
				@if (@item.Status == 1)
				{
				<span class="text text-success">Đơn hàng mới</span>
				}
				else
				{
				<span class="text text-danger">Đơn hàng thành công</span>
				}
				</td> *@
					@* <td>
				<a asp-action="ViewOrder" class="btn btn-warning btn-sm" asp-controller="Order" asp-route-id="@item.OrderCode">View Order</a>
				<a asp-action="Delete" class="btn btn-danger btn-sm confirmDeletion" asp-controller="Order" asp-route-id="@item.Id">Delete</a>
				</td> *@
				</tr>
				stt++;
			}
			<tr>
				<th colspan="5">Total:</th>
				<td>@toTal.ToString("C")</td>
				<td>
					<select class="form-control select-update-order">
						<option value="1">Đơn hàng mới</option>
						<option value="0">Đã xử lý</option>
					</select>
				</td>
			</tr>
		</tbody>
	</table>

</div>


@*Phân trang ở đây*@
<partial name="_paging" model="@pager" />

<a asp-action="Index">Back to List Orders</a>

@section Scripts {
	<script>
		$(document).ready(function () {
			$('.select-update-order').change(function () {
				var status = $(this).val(); //status = 1
				var ordercode = $('.getId').val();
				// alert(status);
				// alert(ordercode);
				$.ajax({
					type: "POST",
					url: "@Url.Action("UpdateOrder")",
					data: { status: status, ordercode: ordercode },
							success: function (result) {
						// Handle successful update
						if (result.success) 
						{
							// Update UI or show success mesage
							// console.log("Update successful");
							Swal.fire("Cập nhật đơn hàng thành công.");
						}
						else 
						{
							// Handle error
							// console.log("Update failed: " + result.message);
							Swal.fire("Cập nhật đơn hàng thất bại: " + result.message);
						}
					}
					// ,
					// error: function (reg, status, error) {
					// 	console.error("Error updating order: ", error);
					// }
				});
			});
		});
	</script>
}